---
title: "HTB Tabby"
date: 2020-09-25 18:45:00 -0700
categories: [HTB, writeup]
tags: [writeup]
toc: true
---

## Introduction

HTB Tabby is a linux-based box.

Author: ``egre55``

Machine IP: ``10.10.10.194``

## Reconnaissance

### nmap

As usual with HTB, the first thing to do is to use nmap to scan the box. The IP of the box is ``10.10.10.194``, as you can see in the command I used:

``nmap -sC -sV -o nmap.nmap 10.10.10.194``

Here is the output of the scan: 

```
kali@kali:~/Desktop/htb/tabby$ nmap -sC -sV -o nmap.nmap 10.10.10.194
Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-24 21:33 EDT
Nmap scan report for tabby.htb (10.10.10.194)
Host is up (0.069s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Mega Hosting
8080/tcp open  http    Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Apache Tomcat
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.72 seconds
```

SSH, a ssh server, and a tomcat server (not sure if those are the correct words to use so bear with me)

Let's check out the apache server first.

I put some random directory in the url to see what would happen, and I ended up finding the version that Tomcat is running on:

`` Apache Tomcat/9.0.31 (Ubuntu) ``

Let's go to the web server.

I looked around for a bit until I found the news page. Once I did I realized something from the url:

```
http://10.10.10.194/news.php/?file=statement
```

It uses ``?file`` so it is vulnerable to LFI. I tested this out and went for /etc/passwd.

```
http://10.10.10.194/news.php/?file=../../../../../etc/passwd
```

It works! Awesome. Armed with this information, let's try to access the ``users.xml`` file mentioned on port 8080.

```
/etc/tomcat9/tomcat-users.xml
```

This is supposedly where the file is but it appears that the file is not there. I googled where tomcat9 is usually installed and saw that it is installed in ``/usr/share/tomcat9/``. 

Now, let's try to go to ``http://10.10.10.194/news.php/?file=../../../../../usr/share/tomcat9/tomcat-users.xml``.

Still nothing. People on the HTB forum suggested that we install the service for ourselves to gain a proper foothold. I watched a video of someone else installing it I managed to find out the proper location.

`` http://10.10.10.194/news.php/?file=../../../../../usr/share/tomcat9/etc/tomcat-users.xml ``

I'm greeted with a blank page, but if I view the source of the page I find something interesting:

```
-->
   <role rolename="admin-gui"/>
   <role rolename="manager-script"/>
   <user username="tomcat" password="$3cureP4s5w0rd123!" roles="admin-gui,manager-script"/>
</tomcat-users>
```

``tomcat:$3cureP4s5w0rd123!``

Sweet, now we have credentials, let's try to find an exploit.

I found this guide for a potential exploit: https://null-byte.wonderhowto.com/how-to/hack-apache-tomcat-via-malicious-war-file-upload-0202593/

After following it, we are able to get a shell. There is a zip file which we can crack and we get the password admin@it. We found the zip file in the user ash's files so we can login with ``ash:admin@it``. With that, we now are able to login and grab the user flag.


## Priv Esc

If you type ``id`` you can see that you are part of the ``lxc`` group. With this group, you can escalate privs.

I followed this guide: https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation

With that, I was able to get the root flag.







